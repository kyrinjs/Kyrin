# Kyrin v0.0.3 - Database Module

‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏° **Native SQLite Client** ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡∏û‡∏£‡πâ‡∏≠‡∏° API ‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢

---

## üÜï ‡∏™‡∏¥‡πà‡∏á‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô v0.0.3

### Native SQLite Client

- ‡πÉ‡∏ä‡πâ `bun:sqlite` ‡∏ó‡∏µ‡πà‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤ `better-sqlite3` 3-6 ‡πÄ‡∏ó‡πà‡∏≤
- Zero dependencies (‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°)
- Type-safe queries ‡∏î‡πâ‡∏ß‡∏¢ generics
- Transaction support ‡∏û‡∏£‡πâ‡∏≠‡∏° auto-rollback

### Minimal SQL API

- **Tagged Template Literal**: `db.sql\`SELECT \* FROM users\``
- **Single Method**: `db.sql("SELECT * FROM users")`
- Chainable: `.all()`, `.first()`, `.run()`

---

## üì¶ ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Database

### Config Object (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

```typescript
import { Database } from "kyrin";

const db = new Database({
  type: "sqlite",
  filename: "./data.db", // ‡∏´‡∏£‡∏∑‡∏≠ ":memory:" ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö in-memory
});
```

### Connection String

```typescript
import { database } from "kyrin";

const db = database("sqlite:./data.db");
const db = database("sqlite::memory:");
```

---

## üîß API Reference

### ‡∏™‡∏£‡πâ‡∏≤‡∏á Table

```typescript
db.exec(`
  CREATE TABLE IF NOT EXISTS users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    email TEXT UNIQUE
  )
`);
```

### Insert / Update / Delete

```typescript
// Insert - ‡πÑ‡∏î‡πâ ID ‡πÉ‡∏´‡∏°‡πà
const { lastInsertRowid } =
  db.sql`INSERT INTO users (name) VALUES (${"John"})`.run();

// Update - ‡πÑ‡∏î‡πâ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
const { changes } =
  db.sql`UPDATE users SET name = ${"Jane"} WHERE id = ${1}`.run();

// Delete
db.sql`DELETE FROM users WHERE id = ${id}`.run();
```

### Query

```typescript
interface User {
  id: number;
  name: string;
}

// ‡∏î‡∏∂‡∏á‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß
const users = db.sql<User>`SELECT * FROM users WHERE age > ${18}`.all();

// ‡∏î‡∏∂‡∏á‡πÅ‡∏ñ‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
const user = db.sql<User>`SELECT * FROM users WHERE id = ${id}`.first();
```

### Transaction

```typescript
db.transaction(() => {
  db.sql`INSERT INTO users (name) VALUES (${"Alice"})`.run();
  db.sql`INSERT INTO users (name) VALUES (${"Bob"})`.run();
  // ‡∏ñ‡πâ‡∏≤ error ‚Üí rollback ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
});
```

### Prepared Statement

```typescript
const findUser = db.prepare<User>("SELECT * FROM users WHERE id = ?");
const user1 = findUser.get(1);
const user2 = findUser.get(2);
findUser.finalize();
```

---

## üåê ‡πÉ‡∏ä‡πâ‡∏Å‡∏±‡∏ö API Routes

```typescript
import { Kyrin, Database } from "kyrin";

const app = new Kyrin();
const db = new Database({ type: "sqlite", filename: "./app.db" });

// GET /users
app.get("/users", () => db.sql`SELECT * FROM users`.all());

// GET /users/:id
app.get("/users/:id", (c) => {
  const id = c.param("id");
  return db.sql`SELECT * FROM users WHERE id = ${id}`.first() ?? c.notFound();
});

// POST /users
app.post("/users", async (c) => {
  const { name } = await c.body<{ name: string }>();
  const { lastInsertRowid } =
    db.sql`INSERT INTO users (name) VALUES (${name})`.run();
  return { id: lastInsertRowid, name };
});

app.listen(3000);
```

---

## ÔøΩ ‡πÉ‡∏ä‡πâ Database ‡∏Å‡∏±‡∏ö Router ‡πÅ‡∏¢‡∏Å‡πÑ‡∏ü‡∏•‡πå

### ‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Ñ

```
src/
‚îú‚îÄ‚îÄ index.ts          # Main app
‚îú‚îÄ‚îÄ db.ts             # Shared database instance
‚îî‚îÄ‚îÄ routes/
    ‚îú‚îÄ‚îÄ users.ts      # User routes
    ‚îî‚îÄ‚îÄ posts.ts      # Post routes
```

### 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á Shared Database Instance

```typescript
// src/db.ts
import { Database } from "kyrin";

export const db = new Database({
  type: "sqlite",
  filename: "./app.db",
});

// Initialize tables
db.exec(`
  CREATE TABLE IF NOT EXISTS users (id INTEGER PRIMARY KEY, name TEXT);
  CREATE TABLE IF NOT EXISTS posts (id INTEGER PRIMARY KEY, title TEXT, user_id INTEGER);
`);
```

### 2. ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô Router Files

```typescript
// src/routes/users.ts
import { Router } from "kyrin";
import { db } from "../db";

export const userRouter = new Router();

userRouter.get("/", () => db.sql`SELECT * FROM users`.all());

userRouter.get("/:id", (c) => {
  const id = c.param("id");
  return db.sql`SELECT * FROM users WHERE id = ${id}`.first();
});

userRouter.post("/", async (c) => {
  const { name } = await c.body<{ name: string }>();
  const { lastInsertRowid } =
    db.sql`INSERT INTO users (name) VALUES (${name})`.run();
  return { id: lastInsertRowid, name };
});
```

```typescript
// src/routes/posts.ts
import { Router } from "kyrin";
import { db } from "../db";

export const postRouter = new Router();

postRouter.get("/", () => db.sql`SELECT * FROM posts`.all());
```

### 3. Mount ‡πÉ‡∏ô Main App

```typescript
// src/index.ts
import { Kyrin } from "kyrin";
import { userRouter } from "./routes/users";
import { postRouter } from "./routes/posts";

const app = new Kyrin();

app.route("/users", userRouter);
app.route("/posts", postRouter);

app.listen(3000);
```

---

## ÔøΩüìã Query Methods

| Method     | ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢                     | Return                         |
| ---------- | ---------------------------- | ------------------------------ |
| `.all()`   | ‡∏î‡∏∂‡∏á‡∏ó‡∏∏‡∏Å‡πÅ‡∏ñ‡∏ß                    | `T[]`                          |
| `.first()` | ‡∏î‡∏∂‡∏á‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å                    | `T \| null`                    |
| `.run()`   | Execute INSERT/UPDATE/DELETE | `{ changes, lastInsertRowid }` |

---

## üîÆ ‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï (Coming Soon)

- PostgreSQL: `database("postgres://user:pass@localhost/mydb")`
- MySQL: `database("mysql://user:pass@localhost/mydb")`
- ORM Adapters: Prisma, Drizzle, Knex wrappers
